<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Money Planner: High DP vs Invest</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Inter', sans-serif; -webkit-font-smoothing: antialiased; }
        
        input[type=range] {
            -webkit-appearance: none; 
            background: transparent; 
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 16px;
            width: 16px;
            border-radius: 50%;
            background: #4f46e5;
            cursor: pointer;
            margin-top: -6px; 
            box-shadow: 0 1px 3px rgba(0,0,0,0.3);
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            cursor: pointer;
            background: #e2e8f0;
            border-radius: 2px;
        }
        
        .glass-panel {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.5);
        }
        
        .number-font { font-feature-settings: "tnum"; font-variant-numeric: tabular-nums; }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 min-h-screen">

    <nav class="sticky top-0 z-30 w-full glass-panel border-b border-slate-200/60">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center gap-2">
                    <div class="w-8 h-8 bg-indigo-600 rounded-lg flex items-center justify-center text-white">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="1" x2="12" y2="23"></line><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path></svg>
                    </div>
                    <span class="font-bold text-lg tracking-tight text-slate-900">SmartMoney<span class="text-indigo-600">Planner</span></span>
                </div>
                <div class="text-xs font-medium px-3 py-1 bg-indigo-50 text-indigo-700 rounded-full">Beta v2.0</div>
            </div>
        </div>
    </nav>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        
        <div class="mb-8">
            <h1 class="text-2xl md:text-3xl font-bold text-slate-900 tracking-tight">Analisa Strategi Tunai</h1>
            <p class="text-slate-500 mt-2 max-w-2xl">Simulasi perbandingan antara membayar deposit tinggi (High DP) untuk mengurangkan hutang, atau membayar deposit minimum dan melaburkan baki tunai (ASB/Tabung Haji).</p>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
            
            <div class="lg:col-span-4 space-y-6">
                
                <div class="bg-white rounded-2xl shadow-sm border border-slate-200 p-1 overflow-hidden">
                    <div class="grid grid-cols-2 gap-1 p-1 bg-slate-50 rounded-xl">
                        <button onclick="setLoanType('car')" id="btn-car" class="relative flex items-center justify-center py-2.5 text-sm font-semibold rounded-lg transition-all duration-200 bg-white text-indigo-600 shadow-sm ring-1 ring-black/5">
                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 17h2c.6 0 1-.9 1-2V9c0-1.1-.9-2-2-2H3c-1.1 0-2 .9-2 2v6c0 1.1.9 2 2 2h2m2-8h.01M7 9h.01M7 17h10M5 21v-2a2 2 0 012-2h10a2 2 0 012 2v2"></path></svg>
                            <div class="text-left leading-tight">
                                <span class="block">Kereta</span>
                                <span class="block text-[10px] font-normal opacity-70">Flat Rate</span>
                            </div>
                        </button>
                        <button onclick="setLoanType('house')" id="btn-house" class="relative flex items-center justify-center py-2.5 text-sm font-medium rounded-lg text-slate-500 hover:text-slate-700 transition-all duration-200">
                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path></svg>
                            <div class="text-left leading-tight">
                                <span class="block">Rumah</span>
                                <span class="block text-[10px] font-normal opacity-70">Reducing</span>
                            </div>
                        </button>
                    </div>
                </div>

                <div class="bg-white rounded-2xl shadow-sm border border-slate-200 p-6 space-y-6">
                    <div class="flex items-center justify-between pb-4 border-b border-slate-100">
                        <h2 class="font-semibold text-slate-800">Tetapan Aset</h2>
                        <span class="text-xs text-slate-400 uppercase font-bold tracking-wider">Langkah 1</span>
                    </div>

                    <div>
                        <div class="flex justify-between mb-2">
                            <label class="text-xs font-semibold text-slate-500 uppercase tracking-wider">Harga Aset</label>
                            <span class="text-xs font-bold text-indigo-600 number-font" id="disp-assetPrice">RM 100,000</span>
                        </div>
                        <div class="relative">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <span class="text-slate-400 font-bold text-sm">RM</span>
                            </div>
                            <input type="number" id="assetPrice" value="100000" class="pl-10 block w-full rounded-lg border-slate-200 bg-slate-50 border focus:bg-white focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm py-2.5 transition-all number-font font-medium" oninput="syncInput('assetPrice')">
                        </div>
                        <input type="range" min="10000" max="1000000" step="1000" value="100000" class="w-full mt-3 accent-indigo-600" oninput="document.getElementById('assetPrice').value = this.value; syncInput('assetPrice')">
                    </div>

                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-xs font-semibold text-slate-500 uppercase tracking-wider mb-2">Tempoh (Tahun)</label>
                            <input type="number" id="loanTenure" value="9" class="block w-full rounded-lg border-slate-200 bg-slate-50 border focus:bg-white focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm py-2.5 px-3 transition-all number-font font-medium" oninput="calculate()">
                        </div>
                        <div>
                            <label class="block text-xs font-semibold text-slate-500 uppercase tracking-wider mb-2">Interest (%)</label>
                            <input type="number" id="loanRate" value="3.5" step="0.1" class="block w-full rounded-lg border-slate-200 bg-slate-50 border focus:bg-white focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm py-2.5 px-3 transition-all number-font font-medium" oninput="calculate()">
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-2xl shadow-sm border border-slate-200 p-6 space-y-6 relative overflow-hidden">
                    <div class="absolute top-0 right-0 p-4 opacity-5">
                        <svg class="w-24 h-24 text-emerald-600" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1.41 16.09V20h-2.67v-1.93c-1.71-.36-3.16-1.46-3.27-3.4h1.96c.1 1.05.82 1.87 2.65 1.87 1.96 0 2.4-.98 2.4-1.59 0-.83-.44-1.61-2.67-2.14-2.48-.6-4.18-1.62-4.18-3.67 0-1.72 1.39-2.84 3.11-3.21V4h2.67v1.95c1.86.45 2.79 1.86 2.85 3.39h-2.05c-.03-.86-.82-1.72-2.66-1.72-1.2 0-2.1.91-2.1 1.68 0 .85.31 1.69 2.66 2.21 2.46.54 4.1 1.65 4.1 3.56 0 1.65-1.49 2.77-3.25 3.02z"/></svg>
                    </div>

                    <div class="flex items-center justify-between pb-4 border-b border-slate-100 relative z-10">
                        <h2 class="font-semibold text-slate-800">Strategi Tunai</h2>
                        <span class="text-xs text-emerald-600 uppercase font-bold tracking-wider">Langkah 2</span>
                    </div>

                    <div class="relative z-10">
                        <div class="flex justify-between mb-2">
                            <label class="text-xs font-semibold text-emerald-700 uppercase tracking-wider">Tunai Di Tangan</label>
                            <span class="text-xs font-bold text-emerald-600 number-font" id="disp-cashOnHand">RM 30,000</span>
                        </div>
                        <div class="relative">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <span class="text-emerald-500 font-bold text-sm">RM</span>
                            </div>
                            <input type="number" id="cashOnHand" value="30000" class="pl-10 block w-full rounded-lg border-emerald-100 bg-emerald-50/50 border focus:bg-white focus:border-emerald-500 focus:ring-emerald-500 sm:text-sm py-2.5 transition-all number-font font-bold text-emerald-800" oninput="syncInput('cashOnHand')">
                        </div>
                        <input type="range" min="0" max="200000" step="1000" value="30000" class="w-full mt-3 accent-emerald-500" oninput="document.getElementById('cashOnHand').value = this.value; syncInput('cashOnHand')">
                    </div>

                    <div class="space-y-4 relative z-10">
                        <div>
                            <label class="block text-xs font-semibold text-slate-500 uppercase tracking-wider mb-2">Dividen ASB (%)</label>
                            <input type="number" id="asbRate" value="5.5" step="0.1" class="block w-full rounded-lg border-slate-200 bg-slate-50 border focus:bg-white focus:border-blue-500 focus:ring-blue-500 sm:text-sm py-2.5 px-3 transition-all number-font font-medium" oninput="calculate()">
                        </div>
                        
                        <div>
                            <label class="block text-xs font-semibold text-slate-500 uppercase tracking-wider mb-2">Min. Deposit</label>
                            <div class="relative">
                                <input type="number" id="minDepoInput" value="10" class="block w-full rounded-lg border-slate-200 bg-slate-50 border focus:bg-white focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm py-2.5 pl-3 pr-24 transition-all number-font font-medium" oninput="calculate()">
                                <div class="absolute inset-y-0 right-1 flex items-center">
                                    <div class="flex bg-slate-100 rounded-md p-1 scale-90">
                                        <button onclick="setDepoMode('percent')" id="btn-depo-percent" class="px-2 py-0.5 text-[10px] font-bold rounded-md bg-white text-indigo-600 shadow-sm transition-all shadow-sm">%</button>
                                        <button onclick="setDepoMode('amount')" id="btn-depo-amount" class="px-2 py-0.5 text-[10px] font-bold rounded-md text-slate-400 hover:text-slate-600 transition-all hover:bg-slate-200">RM</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>

            <div class="lg:col-span-8 space-y-6">
                
                <div id="verdict-card" class="bg-gradient-to-br from-slate-900 to-slate-800 text-white rounded-2xl shadow-xl overflow-hidden relative group">
                    <div class="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] opacity-10"></div>
                    <div class="absolute top-0 right-0 w-64 h-64 bg-white opacity-5 rounded-full blur-3xl transform translate-x-1/2 -translate-y-1/2 group-hover:opacity-10 transition-opacity duration-500"></div>
                    
                    <div class="p-8 relative z-10 flex flex-col md:flex-row items-start md:items-center justify-between gap-6">
                        <div>
                            <div class="flex items-center gap-2 mb-2">
                                <span class="w-2 h-2 rounded-full bg-emerald-400 animate-pulse"></span>
                                <h3 class="text-xs font-bold text-slate-300 uppercase tracking-widest">Keputusan Analisa</h3>
                            </div>
                            <p id="verdict-text" class="text-2xl md:text-3xl font-bold leading-tight tracking-tight mb-2">
                                Mengira...
                            </p>
                            <p class="text-slate-400 text-sm">Berdasarkan parameter kewangan semasa anda.</p>
                        </div>
                        
                        <div class="flex-shrink-0 bg-white/10 backdrop-blur-md border border-white/10 rounded-xl p-4 text-center min-w-[160px]">
                            <p class="text-xs text-slate-300 uppercase tracking-wider font-semibold mb-1">Nilai Bersih Tambahan</p>
                            <p id="verdict-value" class="text-2xl font-bold text-emerald-400 number-font tracking-tight">RM 0</p>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    
                    <div class="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden hover:shadow-md transition-shadow duration-300">
                        <div class="p-5 border-b border-slate-100 bg-slate-50 flex justify-between items-center">
                            <div>
                                <h3 class="font-bold text-slate-800">Senario A</h3>
                                <p class="text-xs text-slate-500 font-medium">Bayar Muka Tinggi</p>
                            </div>
                            <div class="w-8 h-8 rounded-full bg-indigo-100 flex items-center justify-center text-indigo-600">
                                <span class="font-bold text-xs">A</span>
                            </div>
                        </div>
                        <div class="p-5 space-y-4">
                            <div class="flex justify-between items-center group bg-indigo-50/50 -mx-5 px-5 py-2 border-l-4 border-indigo-500">
                                <span class="text-sm font-semibold text-slate-600">Jumlah Deposit</span>
                                <span class="text-sm font-bold text-indigo-700 number-font" id="res-A-deposit">RM 0</span>
                            </div>
                            <div class="flex justify-between items-center group">
                                <span class="text-sm text-slate-500">Jumlah Pinjaman</span>
                                <span class="text-sm font-bold text-slate-900 number-font" id="res-A-loan">RM 0</span>
                            </div>
                            <div class="flex justify-between items-center group">
                                <span class="text-sm text-slate-500">Bayaran Bulanan</span>
                                <span class="text-sm font-bold text-slate-900 number-font" id="res-A-monthly">RM 0</span>
                            </div>
                            <div class="flex justify-between items-center py-2 border-t border-slate-50">
                                <span class="text-sm text-slate-500">Total Interest Dibayar</span>
                                <span class="text-sm font-bold text-rose-500 number-font" id="res-A-interest">RM 0</span>
                            </div>
                            <div class="bg-slate-50 p-3 rounded-lg flex justify-between items-center">
                                <span class="text-xs font-semibold text-slate-500 uppercase">Nilai Tunai Akhir</span>
                                <span class="text-sm font-bold text-slate-400 number-font">RM 0</span>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden hover:shadow-md transition-shadow duration-300">
                        <div class="p-5 border-b border-slate-100 bg-emerald-50/30 flex justify-between items-center">
                            <div>
                                <h3 class="font-bold text-slate-800">Senario B</h3>
                                <p class="text-xs text-slate-500 font-medium">Muka Rendah + Invest</p>
                            </div>
                            <div class="w-8 h-8 rounded-full bg-emerald-100 flex items-center justify-center text-emerald-600">
                                <span class="font-bold text-xs">B</span>
                            </div>
                        </div>
                        <div class="p-5 space-y-4">
                            <div class="flex justify-between items-center bg-emerald-50/50 -mx-5 px-5 py-2 border-l-4 border-emerald-500">
                                <span class="text-sm font-semibold text-slate-600">Jumlah Deposit</span>
                                <span class="text-sm font-bold text-emerald-700 number-font" id="res-B-deposit">RM 0</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-sm text-slate-500">Jumlah Pinjaman</span>
                                <span class="text-sm font-bold text-slate-900 number-font" id="res-B-loan">RM 0</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-sm text-slate-500">Bayaran Bulanan</span>
                                <span class="text-sm font-bold text-slate-900 number-font" id="res-B-monthly">RM 0</span>
                            </div>
                            <div class="flex justify-between items-center py-2 border-t border-slate-50">
                                <span class="text-sm text-slate-500">Total Interest Dibayar</span>
                                <span class="text-sm font-bold text-rose-500 number-font" id="res-B-interest">RM 0</span>
                            </div>
                            <div class="bg-emerald-50 p-3 rounded-lg flex justify-between items-center">
                                <span class="text-xs font-semibold text-emerald-700 uppercase">Nilai ASB Akhir</span>
                                <span class="text-sm font-bold text-emerald-600 number-font" id="res-B-asb">RM 0</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-2xl shadow-sm border border-slate-200 p-6">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="font-bold text-slate-800">Unjuran Kekayaan</h3>
                        <div class="flex gap-4 text-xs">
                            <div class="flex items-center gap-1">
                                <span class="w-2 h-2 rounded-full bg-indigo-500"></span>
                                <span class="text-slate-500">Kos A</span>
                            </div>
                            <div class="flex items-center gap-1">
                                <span class="w-2 h-2 rounded-full bg-emerald-500"></span>
                                <span class="text-slate-500">Untung B</span>
                            </div>
                        </div>
                    </div>
                    <div class="h-64 md:h-80 w-full relative">
                        <canvas id="financeChart"></canvas>
                    </div>
                    <p class="text-xs text-slate-400 mt-4 text-center">Graf menunjukkan perbezaan nilai bersih terkumpul antara kedua-dua senario setiap tahun.</p>
                </div>

            </div>
        </div>
    </main>

    <footer class="max-w-7xl mx-auto px-6 py-8 text-center border-t border-slate-200 mt-8">
        <p class="text-sm text-slate-400">&copy; 2024 Smart Money Planner. Tidak menggantikan nasihat kewangan bertauliah.</p>
    </footer>

    <script>
        let currentLoanType = 'car'; 
        let depositMode = 'percent'; // 'percent' atau 'amount'
        let chartInstance = null;

        const formatRM = (num) => {
            return new Intl.NumberFormat('ms-MY', { style: 'currency', currency: 'MYR', maximumFractionDigits: 0 }).format(num);
        };

        const parseVal = (id) => parseFloat(document.getElementById(id).value) || 0;

        function syncInput(id) {
            const val = document.getElementById(id).value;
            const displayId = 'disp-' + id;
            if(document.getElementById(displayId)) {
                document.getElementById(displayId).innerText = formatRM(val);
            }
            calculate();
        }

        function setLoanType(type) {
            currentLoanType = type;
            
            const btnCar = document.getElementById('btn-car');
            const btnHouse = document.getElementById('btn-house');
            const loanRateInput = document.getElementById('loanRate');
            const loanTenureInput = document.getElementById('loanTenure');

            if (type === 'car') {
                btnCar.className = "relative flex-1 flex items-center justify-center py-2.5 text-sm font-semibold rounded-lg transition-all duration-200 bg-white text-indigo-600 shadow-sm ring-1 ring-black/5";
                btnHouse.className = "relative flex-1 flex items-center justify-center py-2.5 text-sm font-medium rounded-lg text-slate-500 hover:text-slate-700 transition-all duration-200 hover:bg-slate-100";
                loanRateInput.value = 3.0;
                loanTenureInput.value = 9;
            } else {
                btnHouse.className = "relative flex-1 flex items-center justify-center py-2.5 text-sm font-semibold rounded-lg transition-all duration-200 bg-white text-indigo-600 shadow-sm ring-1 ring-black/5";
                btnCar.className = "relative flex-1 flex items-center justify-center py-2.5 text-sm font-medium rounded-lg text-slate-500 hover:text-slate-700 transition-all duration-200 hover:bg-slate-100";
                loanRateInput.value = 4.2;
                loanTenureInput.value = 30;
            }
            calculate();
        }

        function setDepoMode(mode) {
            if (mode === depositMode) return;

            const P_asset = parseVal('assetPrice');
            const input = document.getElementById('minDepoInput');
            let currentVal = parseFloat(input.value) || 0;
            
            // Tukar nilai sedia ada kepada unit baru
            if (mode === 'amount') {
                // Dari % ke RM
                input.value = (P_asset * (currentVal / 100)).toFixed(0);
            } else {
                // Dari RM ke %
                if(P_asset > 0) {
                    input.value = ((currentVal / P_asset) * 100).toFixed(1);
                } else {
                    input.value = 0;
                }
            }

            depositMode = mode;

            // Update butang UI
            const btnPct = document.getElementById('btn-depo-percent');
            const btnAmt = document.getElementById('btn-depo-amount');
            
            if (mode === 'percent') {
                btnPct.className = "px-2 py-0.5 text-[10px] font-bold rounded-md bg-white text-indigo-600 shadow-sm transition-all";
                btnAmt.className = "px-2 py-0.5 text-[10px] font-bold rounded-md text-slate-400 hover:text-slate-600 transition-all hover:bg-slate-200";
            } else {
                btnAmt.className = "px-2 py-0.5 text-[10px] font-bold rounded-md bg-white text-indigo-600 shadow-sm transition-all";
                btnPct.className = "px-2 py-0.5 text-[10px] font-bold rounded-md text-slate-400 hover:text-slate-600 transition-all hover:bg-slate-200";
            }

            calculate();
        }

        function calculate() {
            const P_asset = parseVal('assetPrice');
            const years = parseVal('loanTenure');
            const months = years * 12;
            const rateLoan = parseVal('loanRate') / 100;
            const cashTotal = parseVal('cashOnHand');
            const rateAsb = parseVal('asbRate') / 100;
            
            // Logic Min Deposit (Percent vs Amount)
            const rawDepo = parseVal('minDepoInput');
            let minDepoAmount = 0;

            if (depositMode === 'percent') {
                minDepoAmount = P_asset * (rawDepo / 100);
            } else {
                minDepoAmount = rawDepo;
            }

            // Validation supaya deposit tak lebih harga aset
            if (minDepoAmount > P_asset) minDepoAmount = P_asset;
            
            let dp_A = cashTotal;
            if(dp_A < minDepoAmount) dp_A = minDepoAmount; 
            
            let loanPrincipal_A = P_asset - dp_A;
            if(loanPrincipal_A < 0) loanPrincipal_A = 0;

            let monthly_A = 0;
            let totalInterest_A = 0;

            if (currentLoanType === 'car') {
                totalInterest_A = loanPrincipal_A * rateLoan * years;
                monthly_A = (loanPrincipal_A + totalInterest_A) / months;
            } else {
                if (loanPrincipal_A > 0) {
                    let r_month = rateLoan / 12;
                    monthly_A = loanPrincipal_A * (r_month * Math.pow(1 + r_month, months)) / (Math.pow(1 + r_month, months) - 1);
                    totalInterest_A = (monthly_A * months) - loanPrincipal_A;
                }
            }

            let dp_B = minDepoAmount;
            let initialInvestment_B = cashTotal - dp_B;
            if (initialInvestment_B < 0) initialInvestment_B = 0;

            let loanPrincipal_B = P_asset - dp_B;
            
            let monthly_B = 0;
            let totalInterest_B = 0;

            if (currentLoanType === 'car') {
                totalInterest_B = loanPrincipal_B * rateLoan * years;
                monthly_B = (loanPrincipal_B + totalInterest_B) / months;
            } else {
                let r_month = rateLoan / 12;
                monthly_B = loanPrincipal_B * (r_month * Math.pow(1 + r_month, months)) / (Math.pow(1 + r_month, months) - 1);
                totalInterest_B = (monthly_B * months) - loanPrincipal_B;
            }

            let finalASB_B = initialInvestment_B * Math.pow((1 + rateAsb), years);
            let totalDividend_B = finalASB_B - initialInvestment_B;

            let interestSaved_A = totalInterest_B - totalInterest_A;
            let dividendEarned_B = totalDividend_B;
            let netWin_B = dividendEarned_B - interestSaved_A;

            document.getElementById('res-A-deposit').innerText = formatRM(dp_A);
            document.getElementById('res-A-loan').innerText = formatRM(loanPrincipal_A);
            document.getElementById('res-A-monthly').innerText = formatRM(monthly_A);
            document.getElementById('res-A-interest').innerText = formatRM(totalInterest_A);

            document.getElementById('res-B-deposit').innerText = formatRM(dp_B);
            document.getElementById('res-B-loan').innerText = formatRM(loanPrincipal_B);
            document.getElementById('res-B-monthly').innerText = formatRM(monthly_B);
            document.getElementById('res-B-interest').innerText = formatRM(totalInterest_B);
            document.getElementById('res-B-asb').innerText = formatRM(finalASB_B);

            const verdictText = document.getElementById('verdict-text');
            const verdictValue = document.getElementById('verdict-value');
            const verdictCard = document.getElementById('verdict-card');

            if (netWin_B > 0) {
                verdictText.innerHTML = `Pilih <span class="text-emerald-400 border-b-2 border-emerald-400/30">Senario B</span>`;
                verdictValue.innerText = `+ ${formatRM(netWin_B)}`;
                verdictCard.className = "bg-gradient-to-br from-slate-900 to-slate-800 text-white rounded-2xl shadow-xl overflow-hidden relative group"; 
                verdictValue.className = "text-2xl font-bold text-emerald-400 number-font tracking-tight";
            } else {
                verdictText.innerHTML = `Pilih <span class="text-indigo-400 border-b-2 border-indigo-400/30">Senario A</span>`;
                verdictValue.innerText = `+ ${formatRM(Math.abs(netWin_B))}`; 
                verdictCard.className = "bg-gradient-to-br from-indigo-950 to-indigo-900 text-white rounded-2xl shadow-xl overflow-hidden relative group"; 
                verdictValue.className = "text-2xl font-bold text-indigo-300 number-font tracking-tight";
            }

            updateChart(years, initialInvestment_B, rateAsb, totalInterest_A, totalInterest_B, loanPrincipal_A, loanPrincipal_B, rateLoan);
        }

        function updateChart(years, startInvest, rateInv, totalIntA, totalIntB, principalA, principalB, rateLoan) {
            const ctx = document.getElementById('financeChart').getContext('2d');
            
            let labels = [];
            let dataA = []; 
            let dataB = []; 

            for (let i = 0; i <= years; i++) {
                labels.push(`Thn ${i}`);
                let intCostA = (totalIntA / years) * i;
                dataA.push(-intCostA);
                let intCostB = (totalIntB / years) * i;
                let valB = startInvest * Math.pow((1 + rateInv), i);
                dataB.push(valB - intCostB);
            }

            if (chartInstance) {
                chartInstance.destroy();
            }

            Chart.defaults.font.family = "'Inter', sans-serif";
            Chart.defaults.color = '#94a3b8';

            chartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Senario A (Hanya Jimat Interest)',
                            data: dataA,
                            borderColor: '#6366f1', 
                            backgroundColor: 'rgba(99, 102, 241, 0.05)',
                            borderWidth: 2,
                            tension: 0.4,
                            pointRadius: 0,
                            pointHoverRadius: 6,
                            fill: true
                        },
                        {
                            label: 'Senario B (Untung ASB - Interest)',
                            data: dataB,
                            borderColor: '#10b981', 
                            backgroundColor: 'rgba(16, 185, 129, 0.05)',
                            borderWidth: 2,
                            tension: 0.4,
                            pointRadius: 0,
                            pointHoverRadius: 6,
                            fill: true
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'index',
                        intersect: false,
                    },
                    plugins: {
                        legend: { 
                            position: 'bottom',
                            labels: {
                                usePointStyle: true,
                                padding: 20,
                                font: { size: 12, weight: 500 }
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(15, 23, 42, 0.9)',
                            titleFont: { size: 13 },
                            bodyFont: { size: 13, family: 'Inter' },
                            padding: 10,
                            cornerRadius: 8,
                            displayColors: false,
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label = label.split(' (')[0]; 
                                    }
                                    if (context.parsed.y !== null) {
                                        label += ': ' + new Intl.NumberFormat('ms-MY', { style: 'currency', currency: 'MYR', maximumFractionDigits: 0 }).format(context.parsed.y);
                                    }
                                    return label;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            ticks: {
                                callback: function(value) {
                                    return 'RM ' + value/1000 + 'k';
                                },
                                font: { size: 11 }
                            },
                            grid: { 
                                color: '#f1f5f9',
                                borderDash: [5, 5]
                            },
                            border: { display: false }
                        },
                        x: {
                            grid: { display: false },
                            ticks: { font: { size: 11 } }
                        }
                    }
                }
            });
        }

        window.onload = function() {
            setLoanType('car'); 
            syncInput('assetPrice');
            syncInput('cashOnHand');
        };

    </script>
</body>
</html>
